import{d as Y,M,N as V,x as C,O as se,h as y,r as p,y as X,j as Z,P as fe,v as de,z as ve,A as pe,H as D,a as N,Q as ge,D as me,E as he,K as q,_ as ye}from"./index-DZHv5yw_.js";import{B as be}from"./index-C4j46wO8.js";import{s as m}from"./function-call-zpcYe4ro.js";import{b as L}from"./route-block-B_A1xBdJ.js";function Oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?z(Object(n),!0).forEach(function(r){Oe(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function we(e,t){if(e==null)return{};var n={},r=Object.keys(e),a,o;for(o=0;o<r.length;o++)a=r[o],!(t.indexOf(a)>=0)&&(n[a]=e[a]);return n}function je(e,t){if(e==null)return{};var n=we(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}function Se(e,t){return _e(e)||Pe(e,t)||Me(e,t)||Ee()}function _e(e){if(Array.isArray(e))return e}function Pe(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var n=[],r=!0,a=!1,o=void 0;try{for(var u=e[Symbol.iterator](),i;!(r=(i=u.next()).done)&&(n.push(i.value),!(t&&n.length===t));r=!0);}catch(c){a=!0,o=c}finally{try{!r&&u.return!=null&&u.return()}finally{if(a)throw o}}return n}}function Me(e,t){if(e){if(typeof e=="string")return B(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return B(e,t)}}function B(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ee(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function $e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?H(Object(n),!0).forEach(function(r){$e(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Ie(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(r){return t.reduceRight(function(a,o){return o(a)},r)}}function h(e){return function t(){for(var n=this,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return a.length>=e.length?e.apply(this,a):function(){for(var u=arguments.length,i=new Array(u),c=0;c<u;c++)i[c]=arguments[c];return t.apply(n,[].concat(a,i))}}}function S(e){return{}.toString.call(e).includes("Object")}function Te(e){return!Object.keys(e).length}function b(e){return typeof e=="function"}function Ce(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ae(e,t){return S(t)||d("changeType"),Object.keys(t).some(function(n){return!Ce(e,n)})&&d("changeField"),t}function Ve(e){b(e)||d("selectorType")}function xe(e){b(e)||S(e)||d("handlerType"),S(e)&&Object.values(e).some(function(t){return!b(t)})&&d("handlersType")}function De(e){e||d("initialIsRequired"),S(e)||d("initialType"),Te(e)&&d("initialContent")}function Ne(e,t){throw new Error(e[t]||e.default)}var qe={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},d=h(Ne)(qe),j={changes:Ae,selector:Ve,handler:xe,initial:De};function Le(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};j.initial(e),j.handler(t);var n={current:e},r=h(Be)(n,t),a=h(Ue)(n),o=h(j.changes)(e),u=h(ze)(n);function i(){var s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(l){return l};return j.selector(s),s(n.current)}function c(s){Ie(r,a,o,u)(s)}return[i,c]}function ze(e,t){return b(t)?t(e.current):t}function Ue(e,t){return e.current=F(F({},e.current),t),t}function Be(e,t,n){return b(t)?t(e.current):Object.keys(n).forEach(function(r){var a;return(a=t[r])===null||a===void 0?void 0:a.call(t,e.current[r])}),n}var He={create:Le},Fe={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.52.2/min/vs"}};function ke(e){return function t(){for(var n=this,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return a.length>=e.length?e.apply(this,a):function(){for(var u=arguments.length,i=new Array(u),c=0;c<u;c++)i[c]=arguments[c];return t.apply(n,[].concat(a,i))}}}function Re(e){return{}.toString.call(e).includes("Object")}function We(e){return e||k("configIsRequired"),Re(e)||k("configType"),e.urls?(Ke(),{paths:{vs:e.urls.monacoBase}}):e}function Ke(){console.warn(ee.deprecation)}function Ge(e,t){throw new Error(e[t]||e.default)}var ee={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:"Deprecation warning!\n    You are using deprecated way of configuration.\n\n    Instead of using\n      monaco.config({ urls: { monacoBase: '...' } })\n    use\n      monaco.config({ paths: { vs: '...' } })\n\n    For more please check the link https://github.com/suren-atoyan/monaco-loader#config\n  "},k=ke(Ge)(ee),Je={config:We},Qe=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return function(a){return n.reduceRight(function(o,u){return u(o)},a)}};function te(e,t){return Object.keys(t).forEach(function(n){t[n]instanceof Object&&e[n]&&Object.assign(t[n],te(e[n],t[n]))}),U(U({},e),t)}var Ye={type:"cancelation",msg:"operation is manually canceled"};function E(e){var t=!1,n=new Promise(function(r,a){e.then(function(o){return t?a(Ye):r(o)}),e.catch(a)});return n.cancel=function(){return t=!0},n}var Xe=He.create({config:Fe,isInitialized:!1,resolve:null,reject:null,monaco:null}),ne=Se(Xe,2),O=ne[0],_=ne[1];function Ze(e){var t=Je.config(e),n=t.monaco,r=je(t,["monaco"]);_(function(a){return{config:te(a.config,r),monaco:n}})}function et(){var e=O(function(t){var n=t.monaco,r=t.isInitialized,a=t.resolve;return{monaco:n,isInitialized:r,resolve:a}});if(!e.isInitialized){if(_({isInitialized:!0}),e.monaco)return e.resolve(e.monaco),E($);if(window.monaco&&window.monaco.editor)return re(window.monaco),e.resolve(window.monaco),E($);Qe(tt,rt)(at)}return E($)}function tt(e){return document.body.appendChild(e)}function nt(e){var t=document.createElement("script");return e&&(t.src=e),t}function rt(e){var t=O(function(r){var a=r.config,o=r.reject;return{config:a,reject:o}}),n=nt("".concat(t.config.paths.vs,"/loader.js"));return n.onload=function(){return e()},n.onerror=t.reject,n}function at(){var e=O(function(n){var r=n.config,a=n.resolve,o=n.reject;return{config:r,resolve:a,reject:o}}),t=window.require;t.config(e.config),t(["vs/editor/editor.main"],function(n){re(n),e.resolve(n)},function(n){e.reject(n)})}function re(e){O().monaco||_({monaco:e})}function ot(){return O(function(e){var t=e.monaco;return t})}var $=new Promise(function(e,t){return _({resolve:e,reject:t})}),R={config:Ze,init:et,__getMonacoInstance:ot},it=Object.defineProperty,ut=Object.defineProperties,ct=Object.getOwnPropertyDescriptors,W=Object.getOwnPropertySymbols,lt=Object.prototype.hasOwnProperty,st=Object.prototype.propertyIsEnumerable,K=(e,t,n)=>t in e?it(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,I=(e,t)=>{for(var n in t||(t={}))lt.call(t,n)&&K(e,n,t[n]);if(W)for(var n of W(t))st.call(t,n)&&K(e,n,t[n]);return e},ft=(e,t)=>ut(e,ct(t));const T={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function dt(e,t){const n=C(()=>{const{width:a,height:o}=e;return ft(I({},T.wrapper),{width:a,height:o})}),r=C(()=>I(I({},T.fullWidth),!t.value&&T.hide));return{wrapperStyle:n,containerStyle:r}}function vt(){const e=V(R.__getMonacoInstance()),t=p(!1);let n;return X(()=>{e.value||(n=R.init(),n.then(a=>e.value=a).catch(a=>{(a==null?void 0:a.type)!=="cancelation"&&(t.value=!0,console.error("Monaco initialization error:",a))}))}),{monacoRef:e,unload:()=>n==null?void 0:n.cancel(),isLoadFailed:t}}function G(e){return typeof e=="function"?e():e}function A(e){return e===void 0}function ae(e,t,n,r){return pt(e,r)||gt(e,t,n,r)}function pt(e,t){return e.editor.getModel(oe(e,t))}function gt(e,t,n,r){return e.editor.createModel(t,n,r?oe(e,r):void 0)}function oe(e,t){return e.Uri.parse(t)}var mt=Object.defineProperty,J=Object.getOwnPropertySymbols,ht=Object.prototype.hasOwnProperty,yt=Object.prototype.propertyIsEnumerable,Q=(e,t,n)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,bt=(e,t)=>{for(var n in t||(t={}))ht.call(t,n)&&Q(e,n,t[n]);if(J)for(var n of J(t))yt.call(t,n)&&Q(e,n,t[n]);return e};const Ot={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};var wt=Y({name:"VueMonacoEditor",model:{prop:"value",event:"update:value"},props:{defaultValue:String,defaultPath:String,defaultLanguage:String,value:String,language:String,path:String,theme:{type:String,default:"vs"},line:Number,options:{type:Object,default:()=>({})},overrideServices:{type:Object,default:()=>({})},saveViewState:{type:Boolean,default:!0},width:{type:[Number,String],default:"100%"},height:{type:[Number,String],default:"100%"},className:String},emits:["update:value","beforeMount","mount","change","validate"],setup(e,t){const n=new Map,r=V(null),{monacoRef:a,unload:o,isLoadFailed:u}=vt(),{editorRef:i}=jt(t,e,a,r),{disposeValidator:c}=St(t,e,a,i),s=C(()=>!!a.value&&!!i.value),{wrapperStyle:l,containerStyle:w}=dt(e,s);return se(()=>{var f,v;(f=c.value)==null||f.call(c),i.value?((v=i.value.getModel())==null||v.dispose(),i.value.dispose()):o()}),y([()=>e.path,()=>e.value,()=>e.language,()=>e.line],([f,v,P,g],[x,Et,ue,ce])=>{if(s.value){if(f!==x){const le=ae(a.value,v||e.defaultValue||"",P||e.defaultLanguage||"",f||e.defaultPath||"");e.saveViewState&&n.set(x,i.value.saveViewState()),i.value.setModel(le),e.saveViewState&&i.value.restoreViewState(n.get(f)),A(g)||i.value.revealLine(g);return}i.value.getValue()!==v&&i.value.setValue(v),P!==ue&&a.value.editor.setModelLanguage(i.value.getModel(),P),!A(g)&&g!==ce&&i.value.revealLine(g)}}),y(()=>e.options,f=>i.value&&i.value.updateOptions(f),{deep:!0}),y(()=>e.theme,f=>a.value&&a.value.editor.setTheme(f)),{containerRef:r,isEditorReady:s,isLoadFailed:u,wrapperStyle:l,containerStyle:w}},render(){const{$slots:e,isEditorReady:t,isLoadFailed:n,wrapperStyle:r,containerStyle:a,className:o}=this;return M("div",{style:r},[!t&&M("div",{style:Ot},n?e.failure?G(e.failure):"load failed":e.default?G(e.default):"loading..."),M("div",{ref:"containerRef",key:"monaco_editor_container",style:a,class:o})])}});function jt({emit:e},t,n,r){const a=V(null);X(()=>{const u=y(n,()=>{r.value&&n.value&&(Z(()=>u()),o())},{immediate:!0})});function o(){var u;if(!r.value||!n.value||a.value)return;e("beforeMount",n.value);const i=t.path||t.defaultPath,c=ae(n.value,t.value||t.defaultValue||"",t.language||t.defaultLanguage||"",i||"");a.value=n.value.editor.create(r.value,bt({model:c,theme:t.theme,automaticLayout:!0,autoIndent:"brackets",formatOnPaste:!0,formatOnType:!0},t.options),t.overrideServices),(u=a.value)==null||u.onDidChangeModelContent(s=>{const l=a.value.getValue();l!==t.value&&(e("update:value",l),e("change",l,s))}),a.value&&!A(t.line)&&a.value.revealLine(t.line),e("mount",a.value,n.value)}return{editorRef:a}}function St({emit:e},t,n,r){const a=p(null),o=y([n,r],()=>{if(n.value&&r.value){Z(()=>o());const u=n.value.editor.onDidChangeMarkers(i=>{var c,s;const l=(s=(c=r.value)==null?void 0:c.getModel())==null?void 0:s.uri;if(l&&i.find(f=>f.path===l.path)){const f=n.value.editor.getModelMarkers({resource:l});e("validate",f)}});a.value=()=>u==null?void 0:u.dispose()}});return{disposeValidator:a}}const _t={class:"config-edit-page"},Pt={class:"editor-container"},Mt={class:"footer"},ie=Y({__name:"index",setup(e){const t=fe(),n=de(),r=p(t.query.device?JSON.parse(t.query.device):{}),a=p(""),o=p(!1),u=p(0);async function i(){var s;if((s=r.value)!=null&&s.imei){o.value=!0;try{const l=await q.post("/executeTask",{imei:r.value.imei,task:"get_config"});l.success?a.value=l.result||"":m("获取配置失败")}catch(l){m("获取配置失败")}finally{o.value=!1,u.value=2}}}async function c(){var s;if((s=r.value)!=null&&s.imei){o.value=!0;try{(await q.post("/executeTask",{imei:r.value.imei,task:"set_config",configText:a.value})).success?(m("保存成功"),n.back()):m("保存失败")}catch(l){m("保存失败")}finally{o.value=!1}}}return i(),(s,l)=>{const w=be;return pe(),ve("div",_t,[D("div",Pt,[N(ge(wt),{value:a.value,"onUpdate:value":l[0]||(l[0]=f=>a.value=f),language:"lua",theme:"vs-dark",options:{fontSize:14}},null,8,["value"])]),D("div",Mt,[N(w,{block:"",type:"primary",loading:o.value,onClick:c},{default:me(()=>l[1]||(l[1]=[he(" 保存配置 ")])),_:1,__:[1]},8,["loading"])])])}}});typeof L=="function"&&L(ie);const At=ye(ie,[["__scopeId","data-v-80ad867a"]]);export{At as default};
